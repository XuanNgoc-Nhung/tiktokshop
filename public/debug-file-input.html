<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug File Input</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 3px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .console-output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px; margin-top: 20px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug File Input</h1>
        
        <div class="test-section">
            <h3>Test File Input</h3>
            <input type="file" id="testFileInput" accept="image/*">
            <button class="btn" onclick="testFileInput()">Test File Input</button>
            <button class="btn" onclick="logFileInfo()">Log File Info</button>
        </div>
        
        <div class="test-section">
            <h3>Test Functions</h3>
            <button class="btn" onclick="checkElements()">Check Elements</button>
            <button class="btn" onclick="simulateFileSelection()">Simulate File Selection</button>
            <button class="btn" onclick="clearConsole()">Clear Console</button>
        </div>
        
        <div class="console-output" id="consoleOutput">
            <div>Console output will appear here...</div>
        </div>
    </div>

    <script>
        // Override console.log to display in our custom console
        const originalConsoleLog = console.log;
        const consoleOutput = document.getElementById('consoleOutput');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            div.style.marginBottom = '5px';
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        const fileInput = document.getElementById('testFileInput');

        // Setup file input listener
        fileInput.addEventListener('change', function(e) {
            console.log('üìÅ File input CHANGE event triggered');
            console.log('Event details:', e);
            console.log('Files object:', this.files);
            console.log('Files length:', this.files ? this.files.length : 'no files');
            
            const file = this.files && this.files[0];
            console.log('Selected file:', file);
            
            if (file) {
                // Log detailed file information
                console.log('=== FILE INFORMATION ===');
                console.log('üìÑ File Name:', file.name);
                console.log('üìè File Size:', file.size, 'bytes');
                console.log('üìè File Size (MB):', (file.size / (1024 * 1024)).toFixed(2), 'MB');
                console.log('üè∑Ô∏è File Type:', file.type);
                console.log('üìÖ Last Modified:', new Date(file.lastModified).toLocaleString());
                console.log('üîó File URL (if available):', file.webkitRelativePath || 'N/A');
                console.log('üìä File Properties:', {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified,
                    lastModifiedDate: new Date(file.lastModified),
                    sizeFormatted: formatFileSize(file.size)
                });
                console.log('========================');
            } else {
                console.log('‚ùå No file selected');
            }
        });

        // Test functions
        window.testFileInput = function() {
            console.log('üß™ Testing file input...');
            console.log('File input element:', fileInput);
            console.log('File input value:', fileInput.value);
            console.log('File input files:', fileInput.files);
            console.log('File input accept:', fileInput.accept);
            console.log('File input type:', fileInput.type);
            console.log('File input disabled:', fileInput.disabled);
            console.log('File input style:', fileInput.style.cssText);
            console.log('File input parent:', fileInput.parentElement);
            console.log('File input visible:', fileInput.offsetWidth > 0 && fileInput.offsetHeight > 0);
        };

        window.logFileInfo = function() {
            if (fileInput.files && fileInput.files[0]) {
                const file = fileInput.files[0];
                console.log('=== CURRENT FILE INFO ===');
                console.log('üìÑ Name:', file.name);
                console.log('üìè Size:', formatFileSize(file.size));
                console.log('üè∑Ô∏è Type:', file.type);
                console.log('üìÖ Modified:', new Date(file.lastModified).toLocaleString());
                console.log('========================');
            } else {
                console.log('‚ùå No file currently selected');
            }
        };

        window.checkElements = function() {
            console.log('üîç Checking elements...');
            console.log('File input:', fileInput);
            console.log('File input in DOM:', document.contains(fileInput));
            console.log('File input parent visible:', fileInput.parentElement ? fileInput.parentElement.offsetWidth > 0 : false);
        };

        window.simulateFileSelection = function() {
            console.log('üéØ Simulating file selection...');
            // Create a test file
            const testFile = new File(['test content'], 'test-image.jpg', {
                type: 'image/jpeg',
                lastModified: Date.now()
            });
            
            // Create a new FileList with the test file
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(testFile);
            fileInput.files = dataTransfer.files;
            
            // Trigger change event
            const event = new Event('change', { bubbles: true });
            fileInput.dispatchEvent(event);
            
            console.log('‚úÖ Test file selection completed');
        };

        window.clearConsole = function() {
            consoleOutput.innerHTML = '<div>Console cleared...</div>';
        };

        // Initialize
        console.log('üöÄ Debug File Input Page Loaded');
        console.log('File input element:', fileInput);
    </script>
</body>
</html>
